{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/promise","webpackCompilationHash":"ff31a61670be39266ee7","result":{"data":{"markdownRemark":{"id":"2caf1d99-1756-5c11-80ca-992babea955d","html":"<h2 id=\"promise프로미스\"><a href=\"#promise%ED%94%84%EB%A1%9C%EB%AF%B8%EC%8A%A4\" aria-label=\"promise프로미스 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Promise(프로미스)</h2>\n<p>javascript는 비동기 처리를 위한 하나의 패턴으로 콜백 함수를 사용한다.<br>\n하지만 이 전통적인 콜백 패턴은 가동석이 나쁘고 비동기 처리중 발생한 에러의 예외 처리가 곤란하며 여러 개의 비동기<br>\n처리 로직을 한꺼번에 처리하는 것도 한계가 뚜렷하다.<br>\n비동기 처리를 위해 콜백 패턴을 사용하면 처리 순서를 보장하기 위해 여러 개의 콜백 함수가 중첩되어 복잡도가 높아지는 콜백 헬이 발생하는 단점도 있다.</p>\n<p>▼▼콜백 헬이 발생하는 사례▼▼</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">step1</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">step2</span><span class=\"token punctuation\">(</span>value1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">step3</span><span class=\"token punctuation\">(</span>value2<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">step4</span><span class=\"token punctuation\">(</span>value3<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">step5</span><span class=\"token punctuation\">(</span>value4<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// value5를 사용하는 처리</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>콜백 헬이 발생하는 이유는 비동기 처리는 실행 완료를 기다리지 않고 다음 로직을 실행한다.<br>\n따라서 비동기 함수 내에서 처리 결과를 반환하면 기대한 대로 동작하지 않는다.</p>\n<p>이 문제점을 보완한 Promise가 ES6에서 도입됬다.</p>\n<p>Promise는 Promise 생성자 함수를 통해 인스턴스화한다.<br>\nPromise 생성자 함수는 비동기 작업을 수행 할 콜백 함수를 인자로 전달받는데 이 콜백 함수는 resolve와 reject 함수를<br>\n인자로 전달받는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Promise 객체의 생성</span>\n<span class=\"token keyword\">const</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 비동기 작업을 수행한다.</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">/* 비동기 작업 수행 성공 */</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* 비동기 작업 수행 실패 */</span>\n    <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'failure reason'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Promise는 비동기 처리가 성공(fulfilled)했는지 실패(rejected)했는지 등의 상태 정보를 갖는다.</p>\n<table>\n<thead>\n<tr>\n<th>상태</th>\n<th align=\"center\">의미</th>\n<th align=\"right\">구현</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">pending</code></td>\n<td align=\"center\">비동기 처리가 아직 수행되지<br>않은 상태</td>\n<td align=\"right\">resolve 또는 reject 함수가 아직 <br>호출되지 않은 상태</td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">fulfilled</code></td>\n<td align=\"center\">비동기 처리가 수행된 상태(성공)</td>\n<td align=\"right\">resolve 함수가 호출된 상태</td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">rejected</code></td>\n<td align=\"center\">비동기 처리가 수행된 상태(실패)</td>\n<td align=\"right\">reject 함수가 호출된 상태</td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">settled</code></td>\n<td align=\"center\">비동기 처리가 수행된 상태<br>(성공 또는 실패)</td>\n<td align=\"right\">resolve 또는 reject 함수가 호출된 상태</td>\n</tr>\n</tbody>\n</table>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">promiseAjax</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> payload</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onreadystatechange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 서버 응답 완료가 아니면 무시</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>readyState <span class=\"token operator\">!==</span> XMLHttpRequest<span class=\"token punctuation\">.</span><span class=\"token constant\">DONE</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&amp;&amp;</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">&lt;</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// resolve 메소드를 호출하면서 처리 결과를 전달</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Success!</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// reject 메소드를 호출하면서 에러 메시지를 전달</span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Failed...</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Promise 후속 처리 메서드<br>\nPromise로 구현된 비동기 함수는 Promise 객체를 반환해야한다.<br>\nPromise로 구현된 비동기 함수를 호출하는 caller는 Promise 객체의 후속 처리 메서드를 통해 비동기 처리 결과 또는<br>\n에러 메시지를 전달받아 처리한다.<br>\nPromise 객체는 상태를 갖고있다고 했는데 이 상태에 따라 후속 처리 메서드를 체이닝 방식으로 호출한다.</p>\n<p>then<br>\nthen 메서드는 두 개의 콜백 함수를 인자로 전달 받는다.<br>\n첫번째 콜백 함수는 성공(resolve 함수가 호출된 상태)시 호출되고 두번째 함수는 실패(reject 함수가 호출된 상태)시 호출된다.<br>\n이 then 메서드는 Promise를 반환한다.</p>\n<p>catch<br>\n예외(비동기 처리에서 발생한 에러와 then 메서드에서 발생한 에러)가 발생하면 호출된다.<br>\n이 catch 메서드는 Promise를 반환한다.</p>\n<p>비동기 함수의 처리 결과를 가지고 다른 비동기 함수를 호출해야 하는 경우 함수의 호출이 중첩되어 복잡도가 높아지는<br>\n콜백 헬이 발생한다.<br>\nPromise는 후속 처리 메서드를 체이닝하여 여러 개의 Promise를 연결하여 사용할 수 있는데 이것으로 콜백 헬을 해결한다.</p>","fields":{"slug":"/posts/promise","tagSlugs":["/tag/javascript/","/tag/비동기/"]},"frontmatter":{"date":"2019-09-05","description":"promise에 대한 글","tags":["javascript","비동기"],"title":"Promise"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/promise"}}}